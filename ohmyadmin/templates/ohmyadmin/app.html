{% extends 'ohmyadmin/base.html' %}

{% macro menu_heading(label) %}
    <div class="text-xs uppercase text-gray-500 font-medium px-3 pt-2">{{ label }}</div>
{% endmacro %}

{% macro menu_item(url, label, active) %}
    {% set base_classes = 'hover:bg-gray-200' %}
    {% set active_classes = 'text-accent-900 bg-accent-100 hover:bg-accent-200' %}
    {% set state_classes = active_classes if active else base_classes %}
    <a class="block w-full rounded px-3 py-2 text-sm font-medium {{ state_classes }}" href="{{ url }}">{{ label }}</a>
{% endmacro %}

{% block main %}
    <div class="flex gap-4 h-full">
        <aside class="w-[280px] bg-gray-100 border-r border-r-gray-200 px-4 py-6 flex flex-col gap-5 sticky top-0">
            <section class="px-3">
                <a href="{{ url_for('ohmyadmin.welcome') }}">
                    <img src="{{ theme.logo }}" class="h-8">
                </a>
            </section>
            <section class="space-y-2">
                {% for menu_group in ohmyadmin_main_menu %}
                    <div class="space-y-px">
                        {% if menu_group.label %}
                            {{ menu_heading(menu_group.label) }}
                        {% endif %}
                        {% for item in menu_group.children %}
                            {{ menu_item(item.url, item.label, url_matches(item.url)) }}
                        {% endfor %}
                    </div>
                {% endfor %}
            </section>
            <section class="mt-auto" x-data="{open: false}">
                <button @click="open = !open;" id="user-menu" type="button"
                        class="flex gap-2 items-center rounded hover:bg-gray-200 active:bg-gray-300 p-2 w-full">
                    <div class="h-10 w-10 rounded overflow-hidden">
                        <img src="{{ request.user.avatar }}" class="w-full h-full">
                    </div>
                    <div class="font-medium">{{ request.user }}</div>
                </button>
                {% include 'ohmyadmin/layout/user_menu.html' %}
                <form method="post" id="logout-form" action="{{ url_for('ohmyadmin.logout') }}">
                    <input type="hidden" name="next" value="{{ request.url }}">
                </form>
            </section>
        </aside>
        <article class="w-full h-full p-6">
            <header>
                <h1 class="text-2xl font-semibold mb-5">
                    {% block page_title %}{{ page_title }}{% endblock %}
                </h1>
            </header>
            <main>
                {% block content %}{% endblock %}
            </main>
        </article>
    </div>
{% endblock %}
